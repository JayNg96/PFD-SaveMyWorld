var scorekeeper = new Object; scorekeeper.init = function () { scorekeeper.atlas = imageset.load("images/scorecard.png"), scorekeeper.symbol_types = { NONE: -1, RECYCLE: 0, INCORRECT: 1, RAINBOW: 2 }, scorekeeper.symbol_src = new Array, scorekeeper.symbol_src[scorekeeper.symbol_types.RECYCLE] = { x: 2, y: 2, w: 32, h: 33 }, scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT] = { x: 36, y: 2, w: 30, h: 31 }, scorekeeper.symbol_src[scorekeeper.symbol_types.RAINBOW] = { x: 68, y: 2, w: 80, h: 16 }, scorekeeper.symbol_duration = 30, scorekeeper.symbol_dest = new Array, scorekeeper.symbol_dest[items.recycle_types.PLASTIC] = { mid_x: 56, mid_y: 56 }, scorekeeper.symbol_dest[items.recycle_types.PAPER] = { mid_x: 152, mid_y: 56 }, scorekeeper.symbol_dest[items.recycle_types.GLASS] = { mid_x: 248, mid_y: 56 }, scorekeeper.symbol_dest[items.recycle_types.METAL] = { mid_x: 344, mid_y: 56 }, scorekeeper.symbol_dest[items.recycle_types.LANDFILL] = { mid_x: 40, mid_y: 224 }, scorekeeper.symbol_active = new Array, scorekeeper.symbol_active[items.recycle_types.PLASTIC] = { stype: scorekeeper.symbol_types.NONE, timer: 0 }, scorekeeper.symbol_active[items.recycle_types.PAPER] = { stype: scorekeeper.symbol_types.NONE, timer: 0 }, scorekeeper.symbol_active[items.recycle_types.GLASS] = { stype: scorekeeper.symbol_types.NONE, timer: 0 }, scorekeeper.symbol_active[items.recycle_types.METAL] = { stype: scorekeeper.symbol_types.NONE, timer: 0 }, scorekeeper.symbol_active[items.recycle_types.LANDFILL] = { stype: scorekeeper.symbol_types.NONE, timer: 0 }, scorekeeper.mistakes_to_game_over = 3, scorekeeper.current_high_score = 0, scorekeeper.reset() }, scorekeeper.reset = function () { scorekeeper.total_mistakes = 0, scorekeeper.total_recycles = 0, scorekeeper.end_game = !1, scorekeeper.new_high_score = !1, scorekeeper.current_high_score = scorekeeper.load_high_score() }, scorekeeper.save_score = function (e) { scorekeeper.new_high_score = !1, window.localStorage ? localStorage.recycle_high_score ? e > Number(localStorage.recycle_high_score) && (scorekeeper.new_high_score = !0, scorekeeper.current_high_score = e, localStorage.recycle_high_score = e) : (localStorage.recycle_high_score = e, scorekeeper.current_high_score = e) : e > scorekeeper.current_high_score && (scorekeeper.current_high_score > 0 && (scorekeeper.new_high_score = !0), scorekeeper.current_high_score = e) }, scorekeeper.load_high_score = function () { return window.localStorage ? null === localStorage.getItem("recycle_high_score") ? 0 : Number(localStorage.recycle_high_score) : scorekeeper.current_high_score }, scorekeeper.logic = function () { scorekeeper.total_mistakes >= scorekeeper.mistakes_to_game_over && 0 == scorekeeper.end_game && (scorekeeper.end_game = !0, scorekeeper.save_score(scorekeeper.total_recycles)); for (var e = 0; e < scorekeeper.symbol_active.length; e++)scorekeeper.symbol_active[e].timer > 0 && scorekeeper.symbol_active[e].timer--, 0 == scorekeeper.symbol_active[e].timer && (scorekeeper.symbol_active[e].stype = scorekeeper.symbol_types.NONE) }, scorekeeper.verify = function (e, r) { var s = items.defs[e].rtype == r; if (s && r != items.recycle_types.LANDFILL) { scorekeeper.activate_symbol(scorekeeper.symbol_types.RECYCLE, r), scorekeeper.total_recycles++, gamestate.impact_pause = 2, items.delay_between_items > 64 ? items.delay_between_items -= 2 : items.delay_between_items > 32 && (items.delay_between_items -= 1); for (var o = 0; o < scorekeeper.total_recycles; o++) { var c = Math.floor(Math.random() * items.bin_width) + items.bins[r].left_x; particles.add(c, items.bins_top) } } s || (scorekeeper.activate_symbol(scorekeeper.symbol_types.INCORRECT, r), imageset.shaking = 10, scorekeeper.total_mistakes < scorekeeper.mistakes_to_game_over && scorekeeper.total_mistakes++) }, scorekeeper.activate_symbol = function (e, r) { scorekeeper.symbol_active[r].stype = e, scorekeeper.symbol_active[r].timer = scorekeeper.symbol_duration }, scorekeeper.render = function () { for (var e = 0; e < scorekeeper.symbol_active.length; e++)scorekeeper.symbol_active[e].stype != scorekeeper.symbol_types.NONE && scorekeeper.render_symbol(scorekeeper.symbol_active[e].stype, e); scorekeeper.render_mistakes() }, scorekeeper.render_symbol = function (e, r) { imageset.render(scorekeeper.atlas, scorekeeper.symbol_src[e].x, scorekeeper.symbol_src[e].y, scorekeeper.symbol_src[e].w, scorekeeper.symbol_src[e].h, scorekeeper.symbol_dest[r].mid_x - scorekeeper.symbol_src[e].w / 2, scorekeeper.symbol_dest[r].mid_y - scorekeeper.symbol_src[e].h / 2), e === scorekeeper.symbol_types.RECYCLE && scorekeeper.render_rainbow(r) }, scorekeeper.render_mistakes = function () { for (var e = 0; e < scorekeeper.total_mistakes; e++)imageset.render(scorekeeper.atlas, scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT].x, scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT].y, scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT].w, scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT].h, 360 - e * scorekeeper.symbol_src[scorekeeper.symbol_types.INCORRECT].w, 208) }, scorekeeper.render_rainbow = function (e) { imageset.render(scorekeeper.atlas, scorekeeper.symbol_src[scorekeeper.symbol_types.RAINBOW].x, scorekeeper.symbol_src[scorekeeper.symbol_types.RAINBOW].y, scorekeeper.symbol_src[scorekeeper.symbol_types.RAINBOW].w, scorekeeper.symbol_src[scorekeeper.symbol_types.RAINBOW].h, items.bins[e].left_x, 0) }, scorekeeper.render_current_score = function () { bitfont.render(scorekeeper.total_recycles.toString(), 100, 212, bitfont.JUSTIFY_LEFT) };